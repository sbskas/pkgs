name: liburcu
variant: scratch
shell: /toolchain/bin/bash
dependencies:
  - stage: base
steps:
  - sources:
      - url: https://lttng.org/files/urcu/userspace-rcu-latest-0.13.tar.bz2
        destination: userspace-rcu-latest.tar.bz2
        sha256: cbb20dbe1a892c2a4d8898bac4316176e585392693d498766ccbbc68cf20ba20
        sha512: 7288b5a4a2dca6a75ecaa8553b942b9e7be9cae25776d2448fb0b0c950af9919c369791839607c6c1e6cbd32bbd1e1cafc18ee753f0e3bdc2ed7b65488612580
    prepare:
      - |
        tar -xjf userspace-rcu-latest.tar.bz2 --strip-components=1

        mkdir build
        cd build

        ../configure \
            --prefix=/usr \
            --disable-static
    build:
      - |
        cd build
        make -j $(nproc)
    install:
      - |
        cd build
        make install DESTDIR=/rootfs
finalize:
  - from: /rootfs
    to: /
